[TOC]

## 04 | 系统设计目标（二）：系统怎么做到高可用？

-   **高可用性**，它是指系统具备较高的无故障运行的能力。
-   今天，我带你一起了解下高并发下，我们如何来保证系统的高可用性，以便给你的系统设计提供一些思路。

### 可用性的度量

-   与之相关的概念：
    -   MTBF（Mean Time Between Failure），是平均故障间隔的意思，代表两次故障的间隔时间，也就是系统正常运转的平均时间。这个时间越长，系统稳定性就越高。
    -   MTTR（Mean Time To Repair），表示故障的平均恢复时间，也可以理解为平均故障时间。这个值越小，故障对于用户的影响越小。
-   ![img](imgs/73a87a9bc14a27c9ec9dfda1b72e1e75.jpg)

### 高可用系统设计的思路

#### 1. 系统设计

-   "**Design for failure**" 是我们做高可用系统设计时秉持的第一原则。

-   一些具体的优化方法，如：**failover(故障转移)、超时控制以及降级和限流。**
-   **failover**，可以分两种情况：
    1.  是在完全对等的节点之间做 failover。
        -   节点中不保存状态，每个节点都可以作为另一个节点的镜像。
        -   如果访问某个节点失败，那么简单地随机访问另一个节点就好了。
    2.  是在不对等的节点之间，即系统中存在主节点也存在备节点。
        -   使用“心跳”检测机制，定时检测主节点。
        -   当一段时间未收到心跳包，就可以认为主节点发生故障，可以触发选主的操作。
        -   选主的结果需要在多个备份节点上达到一致，所以，会使用某一种分布式一致性算法，如 Paxos、Raft。
-   **超时**，牺牲了少量的请求，却保证的整体系统的可用性。
-   **降级**，是为了保证核心服务的稳定而牺牲非核心服务的做法。
-   **限流**，通过对并发请求进行限速来保护系统。

#### 2. 系统运维

-   我们从**灰度发布、故障演练**两个方面来考虑如何提升系统的可用性。

### 课程小结

-   **开发**，注重的是如何处理故障，关键词是冗余和取舍。
-   **运维**，注重的是如何避免故障的发生，如，更关注变更管理及如何做故障演练。
-   上面两者结合起来才能组成一套完善的高可用体系。